job: clear
datacenters: [ srnd ]

tasks:
  clear:
    image: "srnd/clear"
    version: "latest"

    env:
      APP_DEBUG: false
      APP_URL: https://clear.codeday.org/
      SESSION_COOKIE: clear

    vault:
      policies:
        - clear
      env:
        clear:
          APPLE_P12_PASSWORD: APPLE_P12_PASSWORD
          APPLE_PASS_ID: APPLE_PASS_ID
          APPLE_TEAM: APPLE_TEAM
          APPLE_TEAM_ID: APPLE_TEAM_ID
          APP_KEY: APP_KEY
          APP_TIMEZONE: APP_TIMEZONE
          AUTH0_CLIENT_ID: AUTH0_CLIENT_ID
          AUTH0_DOMAIN: AUTH0_DOMAIN
          AUTH0_MANAGEMENT_ID: AUTH0_MANAGEMENT_ID
          AUTH0_MANAGEMENT_SECRET: AUTH0_MANAGEMENT_SECRET
          AUTH0_SECRET: AUTH0_SECRET
          AWS_ASSETS_BUCKET: AWS_ASSETS_BUCKET
          AWS_ASSETS_URL: AWS_ASSETS_URL
          AWS_KEY: AWS_KEY
          AWS_REGION: AWS_REGION
          AWS_SECRET: AWS_SECRET
          AWS_WAIVER_BUCKET: AWS_WAIVER_BUCKET
          COGNITOFORMS_SECRET: COGNITOFORMS_SECRET
          DB_DATABASE: DB_DATABASE
          DB_DRIVER: DB_DRIVER
          DB_HOST: DB_HOST
          DB_PASSWORD: DB_PASSWORD
          DB_USERNAME: DB_USERNAME
          FIREBASE_API_KEY: FIREBASE_API_KEY
          MM_COMMUNITY_USERNAME: MM_COMMUNITY_USERNAME
          MM_COMMUNITY_WEBHOOK: MM_COMMUNITY_WEBHOOK
          MM_STAFF_USERNAME: MM_STAFF_USERNAME
          MM_STAFF_WEBHOOK: MM_STAFF_WEBHOOK
          POSTMARK_API_KEY: POSTMARK_API_KEY
          RAYGUN_API_KEY: RAYGUN_API_KEY
          REDIS_DB: REDIS_DB
          REDIS_HOST: REDIS_HOST
          REDIS_PORT: REDIS_PORT
          REDIS_PREFIX: REDIS_PREFIX
          S5_SECRET: S5_SECRET
          S5_TOKEN: S5_TOKEN
          SENDGRID_API_KEY: SENDGRID_API_KEY
          SENDGRID_ASM_MARKETING: SENDGRID_ASM_MARKETING
          SENDGRID_ASM_TRANSACTIONAL: SENDGRID_ASM_TRANSACTIONAL
          SENDGRID_PASSWORD: SENDGRID_PASSWORD
          SENDGRID_USERNAME: SENDGRID_USERNAME
          SHIPSTATION_KEY: SHIPSTATION_KEY
          SHIPSTATION_SECRET: SHIPSTATION_SECRET
          SHIPSTATION_TAG_EVENT: SHIPSTATION_TAG_EVENT
          SHIPSTATION_TAG_GENERAL: SHIPSTATION_TAG_GENERAL
          STRIPE_PUBLIC: STRIPE_PUBLIC
          STRIPE_SECRET: STRIPE_SECRET
          TAXJAR_CATEGORY: TAXJAR_CATEGORY
          TAXJAR_TOKEN: TAXJAR_TOKEN
          TWILIO_FROM: TWILIO_FROM
          TWILIO_SID: TWILIO_SID
          TWILIO_TOKEN: TWILIO_TOKEN

    resources:
      memory: 256

    ports:
      http:
        inner: 80
        lb:
          domain: clear.codeday.org
          cert: codeday.org
