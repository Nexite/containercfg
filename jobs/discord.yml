job: discord
datacenters: [ srnd ]

deployment:
  canaries: 0

tasks:
  johnpeter-discord:
    image: srnd/johnpeter-discord

    resources:
      memory: 100

    env:
      GOOGLE_APPLICATION_CREDENTIALS: /local/serviceAccount.json

    vault:
      policies:
        - johnpeterdiscord

      env:
        johnpeterdiscord:
            BOT_TOKEN: BOT_TOKEN
            CLEVERBOT_API_KEY: CLEVERBOT_API_KEY
            RAYGUN_KEY: RAYGUN_KEY
            CONTENTFUL_ACCESS_TOKEN: CONTENTFUL_ACCESS_TOKEN
            CONTENTFUL_SPACE_ID: CONTENTFUL_SPACE_ID

      files:
        johnpeterdiscord:
          serviceAccount.json:
            contents: "{{- .Data.data.serviceAccount -}}"

  matterbridge:
    image: 42wim/matterbridge

    args:
      - -conf
      - /local/matterbridge.toml

    vault:
      policies:
        - matterbridge

      files:
        matterbridge:
          matterbridge.toml:
            contents: "{{- .Data.data.config -}}"
