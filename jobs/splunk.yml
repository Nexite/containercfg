// Still need to check the port config, the mount config, the traefik tags, and how service registration works here. Also DNS servers, updates, and restarts.
job: splunk
datacenters: [ srnd ]
type: service

tasks:
  splunk: 
    image: splunk/splunk:latest
    version: latest

    resources: 
      cpu: 800
      memory: 700

    ports: 
      http:
        inner: 8000
        lb: 
          domain: splunk.srnd.org
          cert: srnd.org
      collector: 
        inner: 8088
        lb: 
          domain: splunk-collect.srnd.org
          cert: srnd.org
      syslog: 8514
      statsd: 8125

      volumes: 
        share: 
          - fileshare: splunk-db
            mountpoint: /opt/splunk/var
          - fileshare: splunk-etc
            mountpoint: /opt/splunk/etc
      
      vault: 
        policies: 
          - splunk
        env:
          splunk: 
            SPLUNK_PASSWORD: ADMIN_PASSWORD
      
      env: 
        SPLUNK_START_ARGS: --accept-license
