job: minecraft
datacenters: [ srnd ]

deployment:
  canaries: 0

placement:
  speed:

tasks:
  minecraft:
    image: "itzg/minecraft-server"
    args:
      - "--noconsole"

    resources:
      cpu: 7000
      memory: 25150

    volumes:
      host:
        - volume: minecraft
          mountpoint: "/data"
        - volume: minecraft-plugins
          mountpoint: /plugins

    env:
      MEMORY: 10G
      MAX_MEMORY: 24G
      EULA: "TRUE"
      GUI: "FALSE"
      TYPE: PAPER
      VERSION: "1.16.1"
      SERVER_NAME: CodeDay
      MOTD: Everyday is CodeDay if you believe in magic.
      MAX_PLAYERS: 144
      ANNOUNCE_PLAYER_ACHIEVEMENTS: "FALSE"
      ENABLE_COMMAND_BLOCK: "FALSE"
      SPAWN_PROTECTION: 0
      ALLOW_NETHER: "TRUE"

    vault:
      policies:
        - minecraft
      env:
        minecraft:
          OPS: ops

    ports:
      minecraft:
        inner: 25565
        outer: 25565
        lb:
          domain: minecraft.codeday.org
          cert: codeday.org
