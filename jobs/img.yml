job: img
datacenters: [srnd]

tasks:
  picfit:
    image: "codeday/picfit"
    version: "8b599a98e49879cad77e14cc5052e1e4723ae049"

    resources:
      memory: 128

    env:
      PICFIT_CONFIG_PATH: /local/config.json
      GIN_MODE: release

    vault:
      policies:
        - picfit
      files:
        picfit:
          config.json:
            contents: '{{ .Data.data.picfit }}'
          google_creds.json:
            contents: '{{ .Data.data.google }}'

    volumes:
      raw:
        - from: local/config.json
          mountpoint: /etc/picfit/config.json

    ports:
      http:
        inner: 3001
        lb:
          domain: img.codeday.org
          cert: codeday.org
