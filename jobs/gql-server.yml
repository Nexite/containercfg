job: gql-server
datacenters: [srnd]

tasks:
  gql-server:
    image: "codeday/gql-server"

    resources:
      memory: 256
      memory_limit: 2048
      cpu: 200

    vault:
      policies:
        - gql-server
      env:
        gql-server:
          AUTH0_CLIENT_ID: AUTH0_CLIENT_ID
          AUTH0_CLIENT_SECRET: AUTH0_CLIENT_SECRET
          AUTH0_DOMAIN: AUTH0_DOMAIN
          CONTENTFUL_TOKEN: CONTENTFUL_TOKEN
          TOKEN_SECRET: TOKEN_SECRET
          APOLLO_KEY: APOLLO_KEY
          APOLLO_GRAPH_VARIANT: APOLLO_GRAPH_VARIANT
          APOLLO_SCHEMA_REPORTING: APOLLO_SCHEMA_REPORTING

    ports:
      http:
        inner: 4000
        lb:
          domain: graph.codeday.org
          cert: codeday.org
